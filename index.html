<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>4000 Weeks</title>
  <meta name="description" content="A minimalist 4000-week life calendar. Enter your birthday to visualize elapsed and remaining weeks." />
  <style>
    :root {
      --bg: #fff;
      --fg: #000;
      --muted: #888;
      --current: #444;
      --border: #d9d9d9;
      --focus: #000;
      --gap: 2px;
      --label-col: 56px;
    }

    @media (prefers-color-scheme: dark) {
      :root { --bg: #0a0a0a; --fg: #f5f5f5; --muted: #9a9a9a; --current: #cfcfcf; --border: #2a2a2a; --focus: #fff; }
    }

    body {
      margin: 0;
      background: var(--bg);
      color: var(--fg);
      font: 14px/1.4 system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, sans-serif;
    }

    .topbar { position: sticky; top: 0; z-index: 5; background: var(--bg); border-bottom: 1px solid var(--border); padding: 12px 16px; display: flex; flex-wrap: wrap; gap: 12px; align-items: center; }
    .topbar h1 { font-size: 16px; margin: 0 12px 0 0; font-weight: 700; }
    .topbar input, .topbar button { border: 1px solid var(--border); background: transparent; color: var(--fg); padding: 6px 8px; border-radius: 6px; font: inherit; }
    .topbar button:hover { border-color: var(--fg); cursor: pointer; }

    .stats { margin-left: auto; display: flex; gap: 16px; color: var(--muted); }

    .container { padding: 12px 16px 48px; }

    .grid { width: 100%; display: grid; grid-template-columns: var(--label-col) repeat(52, minmax(0, 1fr)); gap: var(--gap); }
    .label { grid-column: 1 / 2; display: flex; align-items: center; justify-content: flex-end; padding-right: 6px; color: var(--muted); font-variant-numeric: tabular-nums; user-select: none; border-right: 1px solid var(--border); }
    .cell { width: 100%; aspect-ratio: 1 / 1; border: 1px solid var(--border); background: transparent; }
    .cell.past { background: var(--fg); border-color: var(--fg); }
    .cell.current { background: var(--current); border-color: var(--current); position: relative; overflow: hidden; }
    .cell.current::after { content: ""; position: absolute; inset: -50% -150%; background: linear-gradient(120deg, rgba(255,255,255,0) 0%, rgba(255,255,255,.6) 50%, rgba(255,255,255,0) 100%); transform: translateX(-100%); animation: shine 2.4s linear infinite; mix-blend-mode: screen; opacity: .9; }
    @keyframes shine { to { transform: translateX(100%); } }
    @media (prefers-reduced-motion: reduce) { .cell.current::after { animation: none; opacity: 0; } }

    .legend { display: flex; gap: 12px; align-items: center; color: var(--muted); margin: 8px 16px 0; }
    .chip { width: 14px; height: 14px; border: 1px solid var(--border); }
    .chip.p { background: var(--fg); border-color: var(--fg); }
    .chip.c { background: var(--current); border-color: var(--current); }
    .footer { color: var(--muted); text-align: center; padding: 24px 16px; border-top: 1px solid var(--border); }
  </style>
</head>
<body>
  <header class="topbar">
    <h1>4000 Weeks</h1>
    <label for="bday">Birthday</label>
    <input id="bday" type="date" />
    <button id="todayBtn">Jump to Today</button>
    <input id="dateSearch" type="search" placeholder="Find a date (YYYY-MM-DD)" />
    <button id="findBtn">Find</button>
    <div class="stats"><div id="ageStat">Age: –</div><div id="weekStat">Week: –</div><div id="yearStat">Year: –</div></div>
  </header>

  <div class="legend"><div class="chip p"></div><span>Past</span><div class="chip c"></div><span>Current</span><div class="chip"></div><span>Future</span></div>
  <main class="container"><div class="grid" id="grid"></div></main>
  <footer class="footer"><small>Black &amp; white life calendar. Data is stored locally in your browser.</small></footer>

  <script>
    const BASE_YEARS = 77;
    const EXTRA_YEARS = 10;
    const WEEKS_PER_YEAR = 52;

    function parseDate(v){ if(!v) return null; const [y,m,d]=v.split('-').map(Number); if(!y||!m||!d) return null; return new Date(y,m-1,d); }
    function startOfDay(d){ return new Date(d.getFullYear(), d.getMonth(), d.getDate()); }
    function weeksBetween(a,b){ return Math.floor((startOfDay(b)-startOfDay(a))/(7*24*60*60*1000)); }
    function addWeeks(d,n){ const r=new Date(d); r.setDate(r.getDate()+n*7); return r; }
    function fmt(d){ return `${d.getFullYear()}-${String(d.getMonth()+1).padStart(2,'0')}-${String(d.getDate()).padStart(2,'0')}`; }
    function yearsBetween(a,b){ return (startOfDay(b)-startOfDay(a))/(365.2425*24*60*60*1000); }

    const gridEl=document.getElementById('grid');
    const bdayEl=document.getElementById('bday');
    const weekStat=document.getElementById('weekStat');
    const yearStat=document.getElementById('yearStat');
    const ageStat=document.getElementById('ageStat');

    let currentTotalWeeks = BASE_YEARS * WEEKS_PER_YEAR;

    function buildSkeleton(totalWeeks){
      currentTotalWeeks = totalWeeks;
      gridEl.innerHTML='';
      const years = Math.ceil(totalWeeks / WEEKS_PER_YEAR);
      const frag=document.createDocumentFragment();
      let i=0;
      for(let y=0;y<years;y++){
        const label=document.createElement('div');
        label.className='label';
        label.textContent=`Y${String(y+1).padStart(2,'0')}`;
        frag.appendChild(label);
        for(let w=0;w<WEEKS_PER_YEAR&&i<totalWeeks;w++,i++){
          const c=document.createElement('button');
          c.className='cell';c.dataset.index=i;frag.appendChild(c);
        }
      }
      gridEl.appendChild(frag);
    }

    function render(bday){
      const today=startOfDay(new Date());
      let totalYears = BASE_YEARS;
      if(bday){
        const age = yearsBetween(bday, today);
        if(age > BASE_YEARS){ totalYears = Math.ceil(age + EXTRA_YEARS); }
      }
      const totalWeeks = totalYears * WEEKS_PER_YEAR;
      if(totalWeeks !== currentTotalWeeks) buildSkeleton(totalWeeks);

      if(!bday){
        weekStat.textContent=`Week: – / ${totalWeeks}`;
        yearStat.textContent=`Year: – of ${totalYears}`;
        return;
      }

      const weeksLived = weeksBetween(bday,today);
      const currentIdx=Math.min(totalWeeks-1,weeksLived);
      const age=yearsBetween(bday,today);

      ageStat.textContent=`Age: ${age.toFixed(2)}`;
      weekStat.textContent=`Week: ${Math.min(weeksLived+1,totalWeeks)} / ${totalWeeks}`;
      yearStat.textContent=`Year: ${(weeksLived/WEEKS_PER_YEAR+1).toFixed(1)} of ${totalYears}`;

      const cells=gridEl.querySelectorAll('.cell');
      cells.forEach((el,i)=>{
        const start=addWeeks(bday,i);const end=addWeeks(bday,i+1);
        el.title=`Week ${i+1}: ${fmt(start)} → ${fmt(new Date(end-1))}`;
        el.classList.remove('past','current');
        if(i===currentIdx)el.classList.add('current');
        else if(i<weeksLived)el.classList.add('past');
      });
      gridEl.querySelector('.cell.current')?.scrollIntoView({block:'center',inline:'nearest'});
    }

    // Init default grid (77 years)
    buildSkeleton(BASE_YEARS * WEEKS_PER_YEAR);

    // Handle birthday input
    bdayEl.addEventListener('input',()=>{ const v=bdayEl.value; const d=parseDate(v); if(!d)return; render(d); });

    // If a birthday is pre-filled (e.g., browser autofill), render on load
    if(bdayEl.value){ const d=parseDate(bdayEl.value); if(d) render(d); }
  </script>
</body>
</html>
